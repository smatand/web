---
interface Props {
  title: string;
  helpText?: string;
  parentHref?: string;
}

const {
  title,
  helpText = "Use arrow keys to navigate. Press Enter to select an item.",
  parentHref,
} = Astro.props;
---

<!doctype html>
<html lang="en" data-parent={parentHref ?? ""}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap");

      :root {
        --bg: #0000aa;
        --text: #ffffff;
        --text-dim: #aaaaaa;
        --yellow: #ffff55;
        --cyan: #55ffff;
        --red-bg: #aa0000;
        --sel-bg: #aaaaaa;
        --sel-text: #000000;
        --border: #ffffff;
        --hotkey-hi: #ffffff;
        --hotkey-lo: #aaaaaa;
      }

      html.dark {
        --bg: #0c0c0c;
        --text: #00ff41;
        --text-dim: #00aa2a;
        --yellow: #00ff00;
        --cyan: #00ffaa;
        --red-bg: #002200;
        --sel-bg: #00ff41;
        --sel-text: #000000;
        --border: #00ff41;
        --hotkey-hi: #00ff41;
        --hotkey-lo: #00aa2a;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: "IBM Plex Mono", "Courier New", monospace;
        font-size: 14px;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 8px;
        line-height: 1.4;
        cursor: default;
      }

      .screen {
        width: 100%;
        max-width: 920px;
        display: flex;
        flex-direction: column;
      }

      /* ── TITLE ── */
      .title-bar {
        text-align: center;
        padding: 6px 0 4px;
      }

      .title-bar .copy {
        color: var(--text-dim);
        font-size: 13px;
      }

      .title-bar .page {
        color: var(--text);
        font-weight: 700;
      }

      /* ── MAIN PANEL ── */
      .panel {
        border: 2px solid var(--border);
        display: flex;
        flex: 1;
        min-height: 0;
      }

      .left {
        flex: 1;
        padding: 8px 12px;
        overflow-y: auto;
        border-right: 2px solid var(--border);
      }

      .right {
        width: 270px;
        flex-shrink: 0;
        padding: 8px 10px;
        border-left: none;
      }

      .right .help-head {
        text-align: center;
        font-weight: 700;
        color: var(--text);
        border-bottom: 1px solid var(--border);
        padding-bottom: 4px;
        margin-bottom: 6px;
      }

      .right .help-menu {
        color: var(--yellow);
        margin-bottom: 8px;
        font-size: 13px;
      }

      .right .help-body {
        color: var(--text);
        font-size: 13px;
        line-height: 1.5;
      }

      /* ── ROWS ── */
      .row {
        display: flex;
        justify-content: space-between;
        padding: 2px 6px;
        text-decoration: none;
        color: var(--text);
        outline: none;
      }

      .row .k { color: var(--text); }
      .row .v { color: var(--yellow); }

      .row.active,
      .row:focus {
        background: var(--sel-bg);
      }

      .row.active .k,
      .row.active .v,
      .row:focus .k,
      .row:focus .v {
        color: var(--sel-text);
      }

      /* first value on the page gets the red highlight like BIOS */
      .row.red-val .v {
        background: var(--red-bg);
        color: var(--text);
        padding: 0 4px;
      }
      .row.red-val.active .v {
        background: var(--sel-bg);
        color: var(--sel-text);
      }

      /* navigation arrows */
      .row .arrow {
        color: var(--yellow);
      }
      .row.active .arrow {
        color: var(--sel-text);
      }

      /* ── SECTION HEADERS ── */
      .sec {
        color: var(--yellow);
        font-weight: 700;
        padding: 2px 6px;
        margin-top: 12px;
      }

      .sec:first-child { margin-top: 0; }

      /* ── INFO LINES ── */
      .ln {
        padding: 1px 6px;
        color: var(--text);
      }

      .ln.dim { color: var(--text-dim); }
      .ln.cy { color: var(--cyan); }

      .ln a {
        color: var(--cyan);
        text-decoration: none;
      }

      .ln a:hover { text-decoration: underline; }

      /* ── SCROLLBAR ── */
      .left::-webkit-scrollbar { width: 12px; background: var(--bg); }
      .left::-webkit-scrollbar-thumb { background: var(--text-dim); }

      /* ── HOTKEY BAR ── */
      .hotbar {
        border: 2px solid var(--border);
        border-top: none;
        padding: 5px 8px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 4px 16px;
        font-size: 12px;
      }

      .hk .hi { color: var(--hotkey-hi); font-weight: 700; }
      .hk .lo { color: var(--hotkey-lo); }

      /* ── GALLERY ── */
      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
        gap: 6px;
        margin-top: 6px;
      }

      .gallery .thumb {
        border: 1px solid var(--border);
        padding: 3px;
        text-align: center;
      }

      .gallery img {
        width: 100%;
        height: auto;
        display: block;
      }

      .gallery .cap {
        font-size: 11px;
        margin-top: 3px;
        color: var(--cyan);
      }

      /* ── RESPONSIVE ── */
      @media (max-width: 700px) {
        .panel { flex-direction: column; }
        .right { width: 100%; border-top: 2px solid var(--border); }
        .left { border-right: none; }
      }
    </style>
  </head>
  <body>
    <div class="screen">
      <div class="title-bar">
        <div class="copy">CMOS Setup Utility - Copyright (C) 1984-2025 Award Software</div>
        <div class="page">{title}</div>
      </div>

      <div class="panel">
        <div class="left">
          <slot />
        </div>
        <div class="right">
          <div class="help-head">Item Help</div>
          <div class="help-menu">Menu Level &nbsp; &#9654;</div>
          <div class="help-body" id="help-body">{helpText}</div>
        </div>
      </div>

      <div class="hotbar">
        <span class="hk"><span class="hi">&#8593;&#8595;</span><span class="lo">:Move</span></span>
        <span class="hk"><span class="hi">Enter</span><span class="lo">:Select</span></span>
        <span class="hk"><span class="hi">+/-</span><span class="lo">:Value</span></span>
        <span class="hk"><span class="hi">F10</span><span class="lo">:Save</span></span>
        <span class="hk"><span class="hi">ESC</span><span class="lo">:Back</span></span>
        <span class="hk"><span class="hi">F1</span><span class="lo">:Help</span></span>
        <span class="hk"><span class="hi">F7</span><span class="lo">:Theme</span></span>
      </div>
    </div>

    <script define:vars={{ parentHref }}>
      const html = document.documentElement;
      const helpBody = document.getElementById("help-body");
      const defaultHelp = helpBody?.textContent ?? "";

      // theme from storage
      if (localStorage.getItem("theme") === "dark") {
        html.classList.add("dark");
      }

      // all navigable rows
      const rows = Array.from(document.querySelectorAll(".row"));
      let idx = 0;

      function activate(i) {
        rows.forEach((r) => r.classList.remove("active"));
        idx = ((i % rows.length) + rows.length) % rows.length;
        const row = rows[idx];
        if (row) {
          row.classList.add("active");
          row.scrollIntoView({ block: "nearest" });
          // update help panel
          if (helpBody) {
            helpBody.textContent = row.dataset.help || defaultHelp;
          }
        }
      }

      if (rows.length > 0) activate(0);

      document.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "ArrowDown":
          case "+":
            e.preventDefault();
            activate(idx + 1);
            break;

          case "ArrowUp":
          case "-":
            e.preventDefault();
            activate(idx - 1);
            break;

          case "Enter": {
            e.preventDefault();
            const el = rows[idx];
            if (el && el.tagName === "A") {
              el.click();
            }
            break;
          }

          case "Escape": {
            e.preventDefault();
            const parent = html.dataset.parent;
            if (parent) {
              window.location.href = parent;
            }
            break;
          }

          case "F7":
            e.preventDefault();
            html.classList.toggle("dark");
            localStorage.setItem(
              "theme",
              html.classList.contains("dark") ? "dark" : "light",
            );
            break;

          case "F1":
            e.preventDefault();
            if (helpBody) {
              helpBody.textContent =
                "↑↓ or +/- to move between items. Enter to follow links. ESC to go back. F7 to toggle theme.";
            }
            break;
        }
      });

      // mouse click on rows
      rows.forEach((row, i) => {
        row.addEventListener("click", () => activate(i));
      });
    </script>
  </body>
</html>
