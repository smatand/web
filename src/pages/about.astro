---
import Base from "../layouts/Base.astro";
import matter from "gray-matter";
import fs from "node:fs";

const raw = fs.readFileSync("src/content/pages/about.md", "utf-8");
const { data } = matter(raw);

const profile: string = data.profile ?? "";
const experience: { company: string; role: string; location: string; duration: string; description: string }[] = data.experience ?? [];
const education: { school: string; faculty?: string; degree: string; location: string; duration: string }[] = data.education ?? [];
const projects: { name: string; url: string; description: string; lang: string }[] = data.projects ?? [];
const languages: string[] = data.languages ?? [];
const spoken: string[] = data.spoken ?? [];
const interests: string[] = data.interests ?? [];
---

<Base title="About / CV">
  <style>
    /* ═══ ABOUT PAGE OVERRIDES ═══ */
    .about-container {
      padding: 0;
    }

    /* Profile section at the top */
    .profile-section {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border-bottom: 2px solid #e94560;
      padding: 20px 0;
      margin: -24px -28px 24px;
    }

    .profile-inner {
      padding: 0 28px;
    }

    .profile-text {
      font-size: 13px;
      line-height: 1.8;
      color: #ccc;
      margin-bottom: 0;
    }

    /* Two-column layout for skills and personal info */
    .about-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    .info-box {
      background: #1a1a2e;
      border: 1px solid #333;
      border-left: 3px solid #e94560;
      padding: 16px;
    }

    .info-box h3 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #e94560;
      border-bottom: 1px solid #333;
      padding-bottom: 8px;
      margin-bottom: 12px;
      margin-top: 0;
    }

    .info-box p {
      margin: 6px 0;
      font-size: 12px;
    }

    .lang-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 6px;
      margin-top: 8px;
    }

    .lang-badge {
      background: #0f3460;
      border: 1px solid #333;
      color: #7ec8e3;
      padding: 4px 8px;
      font-size: 11px;
      text-align: center;
      border-radius: 0;
    }

    /* Timeline layout for experience and education */
    .timeline-section {
      margin-bottom: 32px;
    }

    .timeline-item {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
      position: relative;
      padding-left: 20px;
    }

    .timeline-item::before {
      content: "";
      position: absolute;
      left: 0;
      top: 6px;
      width: 8px;
      height: 8px;
      background: #e94560;
      border: 2px solid #1a1a2e;
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-title {
      font-weight: bold;
      color: #e0e0e0;
      font-size: 14px;
      margin-bottom: 3px;
    }

    .timeline-meta {
      color: #7ec8e3;
      font-size: 12px;
      margin-bottom: 3px;
    }

    .timeline-date {
      color: #e94560;
      font-size: 11px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    .timeline-desc {
      color: #999;
      font-size: 12px;
      line-height: 1.65;
    }

    /* Projects section */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .project-card {
      background: #1a1a2e;
      border: 1px solid #333;
      padding: 12px;
      display: flex;
      flex-direction: column;
    }

    .project-card-title {
      font-weight: bold;
      color: #7ec8e3;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .project-card-title a {
      color: #7ec8e3;
      text-decoration: none;
    }

    .project-card-title a:hover {
      text-decoration: underline;
    }

    .project-card-desc {
      color: #999;
      font-size: 11px;
      margin-bottom: 8px;
      flex: 1;
    }

    .project-card-lang {
      color: #e94560;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Interests and languages section */
    .interest-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .interest-tag {
      background: #1a1a2e;
      border: 1px solid #444;
      color: #7ec8e3;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: bold;
    }

    .interest-tag.primary {
      border-color: #e94560;
      color: #e94560;
    }

    /* Section divider */
    .section-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, #333, transparent);
      margin: 32px 0;
    }

    @media (max-width: 700px) {
      .about-grid {
        grid-template-columns: 1fr;
      }

      .projects-grid {
        grid-template-columns: 1fr;
      }

      .profile-section {
        margin-left: -24px;
        margin-right: -24px;
        padding-left: 24px;
        padding-right: 24px;
      }

      .profile-inner {
        padding: 0;
      }
    }
  </style>

  <div class="about-container">
    {profile && (
      <div class="profile-section">
        <div class="profile-inner">
          <p class="profile-text">{profile}</p>
        </div>
      </div>
    )}

    <!-- Skills and Personal Info Grid -->
    <div class="about-grid">
      <div class="info-box">
        <h3>Programming Languages</h3>
        <div class="lang-grid">
          {languages.map((lang) => (
            <div class="lang-badge">{lang}</div>
          ))}
        </div>
      </div>

      <div class="info-box">
        <h3>Spoken Languages</h3>
        <div class="interest-tags">
          {spoken.map((lang) => (
            <span class="interest-tag">{lang}</span>
          ))}
        </div>
      </div>
    </div>

    <div class="about-grid">
      <div class="info-box">
        <h3>Interests</h3>
        <div class="interest-tags">
          {interests.map((i) => (
            <span class="interest-tag primary">{i}</span>
          ))}
        </div>
      </div>
    </div>

    <!-- Experience Section -->
    <div class="section-divider"></div>
    <h2>Work Experience</h2>
    <div class="timeline-section">
      {experience.map((exp) => (
        <div class="timeline-item">
          <div class="timeline-content">
            <div class="timeline-title">{exp.role}</div>
            <div class="timeline-meta">{exp.company} · {exp.location}</div>
            <div class="timeline-date">{exp.duration}</div>
            <div class="timeline-desc">{exp.description}</div>
          </div>
        </div>
      ))}
    </div>

    <!-- Education Section -->
    <div class="section-divider"></div>
    <h2>Education</h2>
    <div class="timeline-section">
      {education.map((edu) => (
        <div class="timeline-item">
          <div class="timeline-content">
            <div class="timeline-title">{edu.degree}</div>
            <div class="timeline-meta">{edu.faculty ? `${edu.faculty}, ` : ""}{edu.school}</div>
            <div class="timeline-date">{edu.duration} · {edu.location}</div>
          </div>
        </div>
      ))}
    </div>

    <!-- Projects Section -->
    <div class="section-divider"></div>
    <h2>Personal Projects</h2>
    <div class="projects-grid">
      {projects.map((proj) => (
        <div class="project-card">
          <div class="project-card-title">
            <a href={proj.url} target="_blank">{proj.name}</a>
          </div>
          <div class="project-card-desc">{proj.description}</div>
          <div class="project-card-lang">{proj.lang}</div>
        </div>
      ))}
    </div>
  </div>
</Base>
